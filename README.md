# RaaS - RAG as a Service

Сервис для интеллектуального поиска по документам с помощью RAG подхода.

## Идея проекта

RaaS (Retrieval-Augmented Generation as a Service) - это платформа, которая позволяет пользователям:

- Загружать свои документы (PDF)
- Задавать вопросы к содержимому документов
- Получать точные ответы на основе ML-анализа текста

## Основные возможности

**Для пользователей:**
- Регистрация и авторизация
- Загрузка PDF документов
- Запросы к документам через ML-сервис
- Система балансов и оплаты (списание кредитов за запросы)
- История запросов и ответов с указанием стоимости

**Для администраторов:**
- Пополнение баланса пользователям
- Просмотр всех транзакций
- Бесплатные запросы к системе

**Технические особенности:**
- Автоматическая валидация документов (формат, размер, читаемость)
- Проверка баланса перед выполнением запросов
- Расчет стоимости на основе использованных токенов LLM
- Возврат средств при ошибках выполнения

## Архитектура проекта

```
gigaschool/
└── server/
    └── src/
        ├── core/                      # Бизнес-логика
        │   ├── models/                # Доменные модели
        │   │   ├── user_role.py       # Enum: роли пользователей (REGULAR, ADMIN)
        │   │   ├── transaction.py     # Модель финансовых транзакций
        │   │   ├── transaction_type.py
        │   │   ├── transaction_status.py
        │   │   ├── query_status.py
        │   │   ├── document_status.py
        │   │   └── validation_result.py
        │   │
        │   ├── services/              # Сервисы приложения
        │   │   ├── abc/               # Абстрактные базовые классы
        │   │   │   └── BaseValidator.py
        │   │   ├── validators/        # Валидаторы
        │   │   │   ├── balance_validator.py
        │   │   │   └── document_validator.py
        │   │   ├── LLMService.py      # Взаимодействие с LLM (OpenAI API)
        │   │   ├── QdrantService.py   # Векторная БД для эмбеддингов
        │   │   ├── RerankerService.py # Переранжирование результатов поиска
        │   │   └── СhunksService.py   # Разбиение документов на чанки
        │   │
        │   ├── user.py                # Модель пользователя
        │   ├── document.py            # Модель документа
        │   └── query.py               # Модель запроса (RAG pipeline)
        │
        ├── endpoints/                 # REST API (в разработке)
        │   ├── api/
        │   └── models/
        │
        ├── config/                    # Конфигурация
        │   └── Config.py
        │
        ├── utils/                     # Утилиты
        │   ├── logger.py
        │   └── prompt_loader.py
        │
        ├── config.yml                 # Настройки приложения
        └── prompts.yml                # Промпты для LLM
```

## Ключевые компоненты

### Доменные модели

**User** (`core/user.py`)
- Управление балансом (пополнение, списание)
- Разграничение прав (обычный пользователь / админ)
- Проверка возможности выполнения запросов

**Document** (`core/document.py`)
- Валидация загруженных PDF
- Обработка для RAG (извлечение текста, создание чанков)
- Загрузка эмбеддингов в векторную БД

**Query** (`core/query.py`)
- Выполнение RAG pipeline:
  1. Поиск релевантных фрагментов (Qdrant)
  2. Переранжирование (Reranker)
  3. Генерация ответа (LLM)
- Автоматический расчет стоимости по токенам
- Управление балансом пользователя

**Transaction** (`core/models/transaction.py`)
- Учет всех финансовых операций
- Типы: пополнение, списание за запрос, возврат, пополнение админом
- Статусы: ожидание, завершено, отклонено

### ML Сервисы

- **LLMService** - интеграция с OpenAI-совместимым API
- **QdrantService** - векторная база данных для семантического поиска
- **RerankerService** - улучшение релевантности результатов
- **ChunkProcessor** - разбиение документов на семантические блоки